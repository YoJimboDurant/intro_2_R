# Data Import

## Excel Data
 
The _readxl_ package provides functions for importing Excel Spreadsheets:
- Data exported to Excel from CDC's Food Outbreak Online Database (FOOD) (https://wwwn.cdc.gov/foodborneoutbreaks/) 
```{r read_excel}
library(readxl)
fddf <- read_excel("../data/FoodData.xlsx")
```

- in addition to local files, you can also use http, https, and ftp locations.
## Comma Separated Values
Data from https://www.cdc.gov/growthcharts/percentile_data_files.htm
```{r read_csv}
lms_chart <- read.csv("https://www.cdc.gov/growthcharts/data/zscore/wtageinf.csv")
```

## Tab delimited data
- example from MMWR download from CDC's Wonder.
- data are downloaded as plain text, with tabular data in lines 22 - 66.
- `read.delim` with arguments skip and nrows to identify data
```{r download mmwr}
mmwr2017_31 <- read.delim("https://wonder.cdc.gov/mmwr/mmwr_reps.asp?mmwr_year=2017&mmwr_week=31&mmwr_table=2M&request=Export&mmwr_location=", skip =21, nrows = 66, na.strings = "-", header = FALSE)

names(mmwr2017_31) <- c("Reporting Area",
"Salmonellosis current week",
"Salmonellosis previous 52 weeks median", 
"Salmonellosis previous 52 weeks maximum", 
"Salmonellosis cummulative for 2017",
"Salmonellosis cummulative for 2016",
"STEC current week",
"STEC previous 52 weeks median", 
"STEC previous 52 weeks maximum", 
"STEC cummulative for 2017",
"STEC cummulative for 2016",
"Shigellosis current week",
"Shigellosis previous 52 weeks median", 
"Shigellosis previous 52 weeks maximum", 
"Shigellosis cummulative for 2017",
"Shigellosis cummulative for 2016")
```

## SAS Export Files
To download and load NHANES 2013 - 2014 demographic files
```{r NHANES}
library(foreign)
dir.create("./nhanes_files/")
download.file("https://wwwn.cdc.gov/Nchs/Nhanes/2013-2014/DEMO_H.XPT",
                            "./nhanes_files/demo_h.xpt")
demo_h <- read.xport("./nhanes_files/demo_h.xpt")
```


## SAS bat files
Data from ATSDR's National Toxic Substances Incident Program (https://www.atsdr.cdc.gov/ntsip/index.html)
```{r NTIS}
library(haven)
ntis_2014 <- read_sas("https://www.atsdr.cdc.gov/ntsip/docs/ntsippublic2014.sas7bdat")
```


# Data Frame Recoding, Manipulation and Visualization


## NTIS 2014
Let's say you want to find out what the number of incidents are per state:

```{r stateNTIS}
ntis_state <- table(ntis_2014$STATE)
barplot(ntis_state, main = "Number of NTIS Incidents", col="darkblue")

```

Table of Chemicals that have had evacuations:

```{r stateNTIS_evac}
evac_ordered <- ntis_2014[ntis_2014$EVAC_ORD == "Y",]
ntis_evac <- table(evac_ordered$CHEM1)
ntis_evac <- ntis_evac[order(ntis_evac, decreasing = TRUE)]
barplot(ntis_evac[ntis_evac >1], main = "Number of NTIS Incidents", col="darkblue", las=1, cex.names = 0.75, horiz = TRUE)
```
